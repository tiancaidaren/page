<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§äº¤æ˜“æœºå™¨äººæ§åˆ¶é¢æ¿ V5 - ä»ªè¡¨ç›˜</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --chart-bg: #16213e;
            --text-color: #e0e0e0;
            --primary-color: #0f3460;
            --accent-color: #e94560; /* Attack */
            --success-color: #2ecc71;
            --defense-color: #3498db; /* Defense */
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --border-color: rgba(255, 255, 255, 0.1);
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container { width: 100%; max-width: 1000px; }

        .card {
            background-color: var(--primary-color);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            position: relative;
        }

        h1, h2 {
            color: #f1f1f1;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        h1 { text-align: center; border-bottom: 2px solid var(--accent-color); font-size: 1.8em; }
        h2 { font-size: 1.5em; }

        .btn {
            color: white; border: none; padding: 12px 25px; font-size: 1.1em;
            border-radius: 8px; cursor: pointer; transition: all 0.3s;
            display: inline-block; text-align: center; margin-top: 10px;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-start { background-color: var(--success-color); width: 100%; font-size: 1.4em; padding: 15px; }
        .btn-start:hover { background-color: #3bed82; }
        .btn-stop { background-color: var(--error-color); width: 100%; font-size: 1.4em; padding: 15px; }
        .btn-stop:hover { background-color: #ff6b81; }
        .btn-add { background-color: var(--success-color); }
        .btn-test { background-color: var(--defense-color); }

        /* Master Control */
        .master-control { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: center; }
        .status-display { text-align: center; }
        .status-display .label { font-size: 0.9em; color: #aaa; }
        .status-display .value { font-size: 1.8em; font-weight: bold; }
        .status-display .value.running { color: var(--success-color); }
        .status-display .value.stopped { color: var(--error-color); }
        .status-display .value .pnl-positive { color: var(--success-color); }
        .status-display .value .pnl-negative { color: var(--error-color); }

        /* Live Log & Positions */
        .live-data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 800px) { .live-data-grid { grid-template-columns: 1fr; } }
        .live-log { height: 200px; background-color: #000; border-radius: 5px; padding: 10px; overflow-y: scroll; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .log-entry { margin-bottom: 5px; }
        .log-info { color: #bdc3c7; }
        .log-success { color: var(--success-color); }
        .log-warn { color: var(--warning-color); }
        .log-error { color: var(--error-color); }
        .log-time { color: #7f8c8d; margin-right: 10px; }
        .positions-table table { width: 100%; border-collapse: collapse; }
        .positions-table th, .positions-table td { padding: 8px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .positions-table th { font-size: 0.9em; color: #ccc; }
        .pos-long { color: var(--success-color); }
        .pos-short { color: var(--error-color); }

        /* Strategy Item & Toggle */
        .strategy-item { border: 1px solid var(--border-color); background-color: var(--chart-bg); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .strategy-toggle { position: absolute; top: 25px; right: 25px; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Condition Builder */
        .condition-builder { background-color: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; }
        .condition-row { display: grid; grid-template-columns: 1fr 1.5fr auto; gap: 10px; align-items: center; margin-bottom: 10px; }
        .condition-logic { font-weight: bold; color: var(--defense-color); margin: 5px 0; padding-left: 10px; }
        .btn-remove-condition { background: #c0392b; color: white; border: none; border-radius: 50%; width: 28px; height: 28px; font-size: 1.2em; cursor: pointer; line-height: 28px; text-align: center; }
        .condition-actions button { background: none; border: 1px dashed var(--border-color); color: var(--text-color); padding: 5px 10px; cursor: pointer; margin-right: 10px; border-radius: 5px; }

        small { color: #aaa; font-style: italic; display: block; margin-top: 5px;}
    </style>
</head>
<body>

<div class="container">
    <h1>é«˜çº§äº¤æ˜“æœºå™¨äººä»ªè¡¨ç›˜</h1>

    <!-- Master Control -->
    <div class="card">
        <div class="master-control">
            <div class="status-display">
                <div class="label">äº¤æ˜“å¯¹</div>
                <div class="value">BTC/USDT</div>
            </div>
            <div class="status-display">
                <div class="label">è¿è¡ŒçŠ¶æ€</div>
                <div id="bot-status" class="value stopped">å·²åœæ­¢</div>
            </div>
            <div class="status-display">
                <div class="label">ä»Šæ—¥æ€»ç›ˆäº (USDT)</div>
                <div id="total-pnl" class="value">0.00</div>
            </div>
        </div>
        <button id="main-toggle-btn" class="btn btn-start" onclick="toggleBot()">å¯åŠ¨æœºå™¨äºº</button>
    </div>

    <!-- Live Data -->
    <div class="live-data-grid">
        <div class="card">
            <h2>å½“å‰æŒä»“</h2>
            <div class="positions-table">
                <table>
                    <thead><tr><th>æ–¹å‘</th><th>æ•°é‡</th><th>å¼€ä»“å‡ä»·</th><th>æœªå®ç°ç›ˆäº</th></tr></thead>
                    <tbody id="positions-body">
                    <!-- Positions will be added here by JS -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card">
            <h2>å®æ—¶æ—¥å¿—</h2>
            <div class="live-log" id="live-log">
                <div class="log-entry"><span class="log-time"></span><span class="log-info">è¯·å…ˆå¯åŠ¨æœºå™¨äºº...</span></div>
            </div>
        </div>
    </div>

    <!-- Configuration Section -->
    <div class="card">
        <h2>âš™ï¸ é…ç½®ä¸­å¿ƒ</h2>
        <p>æ‚¨å¯ä»¥åœ¨æœºå™¨äººåœæ­¢æ—¶ä¿®æ”¹ä»¥ä¸‹é…ç½®ã€‚ä¿®æ”¹åè¯·é‡æ–°å¯åŠ¨æœºå™¨äººä»¥ä½¿é…ç½®ç”Ÿæ•ˆã€‚</p>
    </div>

    <!-- API Config -->
    <div class="card">
        <h3>ğŸ”Œ API é…ç½®</h3>
        <div class="form-group"><label>API Key</label><input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„API Key"></div>
        <div class="form-group"><label>Secret Key</label><input type="password" placeholder="è¯·è¾“å…¥æ‚¨çš„Secret Key"></div>
        <small>è¯·ç¡®ä¿å·²åœ¨äº¤æ˜“æ‰€åå°ä¸ºè¯¥API Keyå¼€å¯åˆçº¦äº¤æ˜“æƒé™å’ŒåŒå‘æŒä»“æ¨¡å¼ã€‚</small>
    </div>

    <!-- Defense Strategies -->
    <div class="card">
        <h3 style="color: var(--defense-color);">ğŸ›¡ï¸ é˜²å®ˆç­–ç•¥åº“ (å¦‚ä½•ç¦»åœº)</h3>
        <div class="strategy-item">
            <div class="form-group"><label>é˜²å®ˆç­–ç•¥åç§°</label><input type="text" value="3åˆ†é’Ÿå¤šä¿¡å·æ­¢æŸ"></div>
            <div class="form-group"><label>è§¦å‘æ¡ä»¶ç»„ (æ»¡è¶³ä»»ä¸€æ¡ä»¶)</label><div class="condition-builder" id="defense-conditions-1"></div></div>
            <div class="condition-actions"><button onclick="addCondition('defense-conditions-1', 'æˆ–è€…')">+ æˆ–è€…</button></div>
        </div>
    </div>

    <!-- Attack Strategies -->
    <div class="card">
        <h3 style="color: var(--accent-color);">ğŸ“ˆ è¿›æ”»ç­–ç•¥åˆ—è¡¨ (å¦‚ä½•å…¥åœº)</h3>
        <div class="strategy-item">
            <div class="strategy-toggle">
                <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
            </div>
            <div class="form-group"><label>è¿›æ”»ç­–ç•¥åç§°</label><input type="text" value="1å°æ—¶BOLL+SARå…±æŒ¯åšå¤š"></div>
            <div class="form-group"><label>è§¦å‘æ¡ä»¶ç»„ (å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶)</label><div class="condition-builder" id="attack-conditions-1"></div></div>
            <div class="condition-actions"><button onclick="addCondition('attack-conditions-1', 'å¹¶ä¸”')">+ å¹¶ä¸”</button></div>
            <div class="form-group"><label>ä»“ä½ç®¡ç† (å‡¯åˆ©å…¬å¼)</label><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"><input type="text" placeholder="ç­–ç•¥èƒœç‡ (%) ä¾‹: 60"><input type="text" placeholder="ç­–ç•¥ç›ˆäºæ¯” ä¾‹: 2.5"></div></div>
            <div class="form-group"><label>å…³è”é˜²å®ˆç­–ç•¥</label><select><option>3åˆ†é’Ÿå¤šä¿¡å·æ­¢æŸ</option></select></div>
        </div>
    </div>
</div>

<div id="condition-template" style="display: none;"><div class="condition-row"><select class="indicator-select"><option>BOLL</option><option>SAR</option><option>VOL</option></select><select class="rule-select"></select><button class="btn-remove-condition" onclick="this.parentElement.remove()">-</button></div></div>

<script>
    let isBotRunning = false;
    let logInterval;

    const rules = {
        'BOLL': ['æ”¶ç›˜ä»· < ä¸‹è½¨', 'æ”¶ç›˜ä»· > ä¸Šè½¨', 'æ”¶ç›˜ä»· > ä¸­è½¨', 'æ”¶ç›˜ä»· < ä¸­è½¨'],
        'SAR': ['ä»ä¸Šæ–¹ç¿»è½¬è‡³ä¸‹æ–¹ (ä¹°å…¥ä¿¡å·)', 'ä»ä¸‹æ–¹ç¿»è½¬è‡³ä¸Šæ–¹ (å–å‡ºä¿¡å·)'],
        'VOL': ['æ”¾é‡ (å¤§äºè¿‘æœŸå‡é‡)', 'ç¼©é‡ (å°äºè¿‘æœŸå‡é‡)']
    };

    function toggleBot() {
        isBotRunning = !isBotRunning;
        const statusEl = document.getElementById('bot-status');
        const btnEl = document.getElementById('main-toggle-btn');
        const logEl = document.getElementById('live-log');

        if (isBotRunning) {
            statusEl.textContent = 'è¿è¡Œä¸­';
            statusEl.className = 'value running';
            btnEl.textContent = 'åœæ­¢æœºå™¨äºº';
            btnEl.className = 'btn btn-stop';
            logEl.innerHTML = '';
            addLog('æœºå™¨äººå·²å¯åŠ¨ï¼Œå¼€å§‹ç›‘å¬å¸‚åœº...', 'info');
            logInterval = setInterval(simulateBotActivity, 3000);
        } else {
            statusEl.textContent = 'å·²åœæ­¢';
            statusEl.className = 'value stopped';
            btnEl.textContent = 'å¯åŠ¨æœºå™¨äºº';
            btnEl.className = 'btn btn-start';
            clearInterval(logInterval);
            addLog('æœºå™¨äººå·²æ‰‹åŠ¨åœæ­¢ã€‚', 'warn');
            clearPositions(); // Clear positions on stop for this demo
        }
    }

    function addLog(message, type = 'info') {
        const logEl = document.getElementById('live-log');
        const time = new Date().toLocaleTimeString();
        logEl.innerHTML += `<div class="log-entry"><span class="log-time">[${time}]</span><span class="log-${type}">${message}</span></div>`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    function simulateBotActivity() {
        const activities = [
            () => addLog('æ­£åœ¨ç›‘å¬ 1å°æ—¶ Kçº¿ä¿¡å·...', 'info'),
            () => addLog('æ­£åœ¨ç›‘å¬ 4å°æ—¶ Kçº¿ä¿¡å·...', 'info'),
            () => {
                addLog('è¿›æ”»ç­–ç•¥[1å°æ—¶BOLL+SARå…±æŒ¯åšå¤š]æ¡ä»¶æ»¡è¶³!', 'success');
                addLog('æ ¹æ®å‡¯åˆ©å…¬å¼è®¡ç®—ä»“ä½: 0.5 BTC', 'info');
                addLog('æ­£åœ¨æäº¤å¼€å¤šä»“è®¢å•...', 'info');
                setTimeout(() => {
                    addLog('å¼€ä»“æˆåŠŸ!', 'success');
                    addPosition('å¤š', 0.5, 65123.45, '1å°æ—¶BOLL+SARå…±æŒ¯åšå¤š');
                }, 500);
            },
            () => addLog('å¸‚åœºæ— æ˜æ˜¾ä¿¡å·ï¼Œç»§ç»­ç­‰å¾…...', 'info'),
            () => addLog('APIè¿æ¥å¿ƒè·³æ­£å¸¸ã€‚', 'info'),
            () => {
                addLog('é˜²å®ˆç­–ç•¥[3åˆ†é’Ÿå¤šä¿¡å·æ­¢æŸ]æ¡ä»¶è§¦å‘!', 'warn');
                addLog('æ­£åœ¨æäº¤å¹³ä»“è®¢å•...', 'info');
                setTimeout(() => {
                    addLog('å¹³ä»“æˆåŠŸï¼Œç›ˆåˆ©: +250.75 USDT', 'success');
                    clearPositions();
                    updatePnl(250.75);
                }, 500);
            },
            () => addLog('ç½‘ç»œå»¶è¿Ÿæ£€æµ‹: 80ms', 'info'),
            () => addLog('é”™è¯¯: æ— æ³•è·å–æœ€æ–°ä»·æ ¼ï¼Œ1ç§’åé‡è¯•...', 'error')
        ];
        const randomIndex = Math.floor(Math.random() * activities.length);
        activities[randomIndex]();
    }

    function addPosition(direction, quantity, price, strategy) {
        const tbody = document.getElementById('positions-body');
        const dirClass = direction === 'å¤š' ? 'pos-long' : 'pos-short';
        const pnl = (Math.random() * 200 - 100).toFixed(2); // Random PnL for demo
        const pnlClass = pnl > 0 ? 'pnl-positive' : 'pnl-negative';

        tbody.innerHTML = `
                <tr>
                    <td class="${dirClass}">${direction}</td>
                    <td>${quantity} BTC</td>
                    <td>${price}</td>
                    <td class="${pnlClass}">${pnl} USDT</td>
                </tr>`;
    }

    function clearPositions() {
        document.getElementById('positions-body').innerHTML = '';
    }

    function updatePnl(amount) {
        const pnlEl = document.getElementById('total-pnl');
        let currentPnl = parseFloat(pnlEl.textContent);
        currentPnl += amount;
        pnlEl.textContent = currentPnl.toFixed(2);
        pnlEl.className = currentPnl >= 0 ? 'value pnl-positive' : 'value pnl-negative';
    }

    // --- Condition Builder Logic (from V4) ---
    function populateRules(indicatorSelect, ruleSelect) {
        const selectedIndicator = indicatorSelect.value;
        ruleSelect.innerHTML = '';
        rules[selectedIndicator].forEach(rule => {
            const option = document.createElement('option');
            option.value = rule;
            option.textContent = rule;
            ruleSelect.appendChild(option);
        });
    }

    function addCondition(containerId, logic) {
        const container = document.getElementById(containerId);
        if (container.children.length > 0) {
            const logicEl = document.createElement('div');
            logicEl.className = 'condition-logic';
            logicEl.textContent = logic;
            container.appendChild(logicEl);
        }
        const template = document.getElementById('condition-template');
        const newRow = template.firstElementChild.cloneNode(true);
        const indicatorSelect = newRow.querySelector('.indicator-select');
        const ruleSelect = newRow.querySelector('.rule-select');
        indicatorSelect.addEventListener('change', () => populateRules(indicatorSelect, ruleSelect));
        container.appendChild(newRow);
        populateRules(indicatorSelect, ruleSelect);
    }

    // Initialize default conditions
    document.addEventListener('DOMContentLoaded', () => {
        addCondition('defense-conditions-1', 'æˆ–è€…');
        addCondition('attack-conditions-1', 'å¹¶ä¸”');
    });
</script>

</body>
</html>